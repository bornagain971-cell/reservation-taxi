<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Taxi LI — Réservation Guadeloupe</title>
<link href="assets/styles.css" rel="stylesheet"/>
<style>
.field-error{display:none;color:#c53030;font-size:.9rem;margin-top:6px}
.input-error{border-color:#c53030 !important; outline-color:#c53030 !important;}
</style>
<style>
textarea#notes::placeholder {
  text-align: center;
  white-space: pre-line;
}
</style>
<style id="alpha-autoclean-css">
.field-error{color:#c1121f;font-weight:700;margin-top:6px;font-size:0.95rem}
.input-invalid{border-color:#c1121f !important;box-shadow:0 0 0 2px rgba(193,18,31,.1)}
</style>
<style id="global-error-css">
.form-global-error{
  background:#ffe6e6;
  border:1px solid #ffb3b3;
  color:#b00020;
  padding:10px 12px;
  border-radius:8px;
  margin:12px 0;
  font-weight:600;
}
.field-error{color:#c1121f;font-weight:700;margin-top:6px;font-size:0.95rem}
.input-invalid{border-color:#c1121f !important;box-shadow:0 0 0 2px rgba(193,18,31,.1)}
</style>
<style id="wait-ui-toggle-css">
.is-disabled { opacity: .6; pointer-events: none; }
</style>
</head>
<body>
<div class="container">
<div class="header">
<div class="header-left"><img alt="Taxi LI logo" src="images/logo.png"/></div>
<div class="header-center"><h1>Taxi Li Réservation Guadeloupe</h1><div class="tagline">Le plaisir de vous conduire</div></div>
<div class="header-right">
<a href="tel:+590691280005">0691 28 00 05</a>
<a href="https://wa.me/590691280005" target="_blank">WhatsApp</a>
<a href="#form">Réserver</a>
</div>
</div>
<div class="grid">
<div class="card">
<h2>Réservez votre taxi en ligne simplement et rapidement</h2>
<p>Courses locales et longues distances. Tarifs clairs, confirmation instantanée sur WhatsApp ou e‑mail.</p>
<div class="badges">
<div class="badge">Disponibilité 24/7*</div>
<div class="badge">Paiement CB/espèces</div>
<div class="badge">Siège enfant sur demande</div>
</div>
<div class="small">* Selon planning — réponse rapide.</div>
<div class="gallery">
<h3 style="margin:16px 0 8px 0">Notre véhicule en images</h3>
<div class="slider">
<div id="slides"></div>
</div>
<div class="dots" id="dots"></div>
</div>
</div>
<div class="card" id="form">
<div class="form-row">
<div><label for="name">Nom et prénom *</label><input id="name" required=""/><div class="field-error" id="nameAlphaError" style="display:none">Veuillez saisir uniquement des lettres (accents et espaces autorisés). Merci !</div></div>
<div><label for="phone">Téléphone *</label><input id="phone" required="" type="tel"/><div class="field-error" id="phoneError" style="display:none">Veuillez saisir uniquement un numéro valide : chiffres uniquement, « + » autorisé au début. Merci !</div></div>
</div>
<div class="form-row">
<div><label for="start">Lieu de départ *</label><input id="start" placeholder="Adresse, aéroport, hôtel…" required=""/></div>
<div><label for="end">Destination *</label><input id="end" placeholder="Adresse, aéroport, hôtel…" required=""/></div>
</div>
<div class="form-row">
<div><label for="date">Date *</label><input id="date" required="" type="date"/><div class="field-error" id="dateErrorMin" style="display:none">Veuillez sélectionner une date à partir d'aujourd'hui.</div></div>
<div><label for="time">Heure *</label><input id="time" required="" type="time"/><div class="field-error" id="timeErrorNow" style="display:none">Veuillez choisir une heure ultérieure à l'heure actuelle pour aujourd'hui.</div></div>
</div>
<div class="form-row">
<div><label for="pax">Passagers</label><select id="pax"><option>1</option><option>2</option><option>3</option><option>4</option></select></div>
<div><label for="bags">Bagages</label><select id="bags"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option></select></div>
</div>
<div class="form-row">
<div><label for="roundtrip">Aller/retour</label><select id="roundtrip"><option>Non</option><option>Oui</option></select></div>
<div><label for="waitOnTrip">Attente pendant le trajet</label><select id="waitOnTrip"><option>Non</option><option>Oui</option></select></div>
</div>
<div class="form-row">
<div><label for="waitHours">Durée d’attente (heures)</label><select id="waitHours"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option></select></div>
<div><label for="child">Siège enfant</label><select id="child"><option>Non</option><option>Oui</option></select></div>
</div>
<div><label for="notes">Notes utiles</label><textarea id="notes" placeholder="Détails utiles :
code de porte, vol, lieu précis…
Pour plus d’informations,
contactez-nous."></textarea></div>
<div class="card" style="margin-top:14px">
<div class="calc">
<button class="btn" id="estimateBtn" type="button">Estimation du prix</button>
<div class="result" id="estimateOut">—</div>
</div>
<div class="small" style="margin-top:10px">
            Saisissez départ, destination, date et heure (et attente si activée), puis cliquez.<br/>
            Le prix affiché est indicatif ; le prix exact est déterminé par le taximètre (compteur kilométrique). Pour plus d’informations, contactez‑nous.
          </div>
<div id="confirmArea" style="margin-top:14px;text-align:center">
<button class="btn" id="confirmBtn" type="button">Réserver</button>
</div>
</div>
</div>
</div>
<div class="card" style="margin-top:18px">
<h3>Tarifs &amp; transparence</h3>
<p>Le prix final est déterminé par le <strong>taximètre (compteur kilométrique)</strong> selon le trajet réel (embouteillages, déviations, etc.).</p>
<table class="table">
<thead><tr><th>Élément</th><th>Montant</th></tr></thead>
<tbody>
<tr><td>Prise en charge</td><td>3,75 €</td></tr>
<tr><td>Tarif A (aller/retour de jour, au km)</td><td>1,03 €/km</td></tr>
<tr><td>Tarif B (aller/retour de nuit et jour férié, au km)</td><td>1,55 €/km</td></tr>
<tr><td>Tarif C (aller simple de jour, au km)</td><td>2,06 €/km</td></tr>
<tr><td>Tarif D (aller simple de nuit et jour férié, au km)</td><td>3,06 €/km</td></tr>
<tr><td>Heure d’attente pendant les courses (par heure)</td><td>25 €</td></tr>
</tbody>
</table>
<ul>
<li>Facturation claire — pas de surprises.</li>
<li>Reçus sur demande (professionnels et particuliers).</li>
<li>Courtes et longues distances, aéroports, hôtels, rendez‑vous médicaux…</li>
<li>Paiement par carte, espèces ou lien de paiement sécurisé.</li>
</ul>
<div class="small">Tarifs susceptibles d’évoluer, sous réserve de modifications préfectorales.</div>
</div>
<div class="footer container" style="text-align:center;margin:24px auto">
      © TAXI LI — Guadeloupe. Zone principale : Capesterre‑Belle‑Eau, Le Gosier, Goyave — déplacements dans toute la Guadeloupe.
        <a href="mailto:taxili@laposte.net">taxili@laposte.net</a> — <a href="tel:+590691280005">0691 28 00 05</a>
</div>
</div>
<script src="assets/app.js"></script>
<script src="assets/wait_hours.patch.js"></script>
<script async="" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA0neqw7tsdowV0wm4gYPOEIGye7m3TgnE&amp;libraries=places&amp;callback=initPlaces"></script>
<script>
// Dummy estimator just to keep layout identical; user can integrate real calc if needed.
document.getElementById('estimateBtn').addEventListener('click', ()=>{
  document.getElementById('estimateOut').textContent = '—';
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const dateInput = document.getElementById("date");
  const timeInput = document.getElementById("time");
  const now = new Date();

  if (dateInput) {
    const yyyy = now.getFullYear();
    const mm = String(now.getMonth() + 1).padStart(2,"0");
    const dd = String(now.getDate()).padStart(2,"0");
    dateInput.value = `${yyyy}-${mm}-${dd}`;
  }

  if (timeInput) {
    const hh = String(now.getHours()).padStart(2,"0");
    const mm2 = String(now.getMinutes()).padStart(2,"0");
    timeInput.value = `${hh}:${mm2}`;
  }
});
</script>
<script>
(function () {
  const estimateBtn = document.querySelector('#estimateBtn, button[data-role="estimate"], .btn-estimate');
  const depart = document.querySelector('#start, #depart, #origin, input[name="origin"], input[name="start"]');
  const dest = document.querySelector('#end, #destination, #dest, input[name="destination"]');

  if (!estimateBtn || !depart || !dest) return;

  let errorEl = document.createElement('div');
  errorEl.id = 'estimate-error';
  errorEl.style.display = 'none';
  errorEl.style.color = '#c53030';
  errorEl.style.marginTop = '8px';
  errorEl.style.fontSize = '0.9rem';
  errorEl.setAttribute('aria-live', 'polite');

  const priceBox = document.querySelector('#priceBox, .price-box, #estimatePriceBox') || estimateBtn.parentElement;
  priceBox.appendChild(errorEl);

  function clearError() {
    errorEl.style.display = 'none';
    errorEl.textContent = '';
  }

  function validate() {
    const d = depart.value.trim();
    const a = dest.value.trim();
    if (!d || !a) {
      errorEl.textContent = "Oups ! Pour obtenir votre estimation, indiquez d’abord le lieu de départ et la destination.";
      errorEl.style.display = 'block';
      return false;
    }
    clearError();
    return true;
  }

  estimateBtn.addEventListener('click', function (e) {
    if (!validate()) {
      e.preventDefault();
      e.stopPropagation();
    }
  });

  depart.addEventListener('input', clearError);
  dest.addEventListener('input', clearError);
})();
</script>
<script>
(function(){
  function ready(fn){ if(document.readyState!=="loading"){fn();} else {document.addEventListener("DOMContentLoaded", fn);} }

  ready(function(){
    var confirmBtn = document.getElementById('confirmBtn') || document.querySelector('button[data-role="confirm"], .btn-confirm');
    if(!confirmBtn) return;

    // Helpers to find fields with tolerant selectors
    var nameEl  = document.querySelector('#name, input[name="name"], #fullname, #fullName');
    var phoneEl = document.querySelector('#phone, input[name="phone"], #tel, input[type="tel"]');
    var depEl   = document.querySelector('#start, #depart, #origin, input[name="origin"], input[name="start"]');
    var dstEl   = document.querySelector('#end, #destination, #dest, input[name="destination"]');

    function getOrCreateError(el, idSuffix, msg){
      if(!el) return null;
      var id = el.id ? el.id + '-err' : ('field-' + idSuffix + '-err');
      var err = document.getElementById(id);
      if(!err){
        err = document.createElement('div');
        err.id = id;
        err.className = 'field-error';
        err.textContent = msg;
        // insert right after the input
        if(el.parentNode){
          el.parentNode.appendChild(err);
        } else {
          el.insertAdjacentElement('afterend', err);
        }
      }else{
        err.textContent = msg;
      }
      return err;
    }

    // Prepare error elements (created once)
    var errName  = getOrCreateError(nameEl,  'name',  'Merci d’indiquer vos nom et prénom.');
    var errPhone = getOrCreateError(phoneEl, 'phone', 'Merci de renseigner votre numéro de téléphone.');
    var errDep   = getOrCreateError(depEl,   'start', 'Merci de préciser le lieu de départ.');
    var errDst   = getOrCreateError(dstEl,   'end',   'Merci de préciser la destination.');

    function show(el, err){
      if(!el || !err) return;
      err.style.display = 'block';
      el.classList.add('input-error');
    }
    function hide(el, err){
      if(!el || !err) return;
      err.style.display = 'none';
      el.classList.remove('input-error');
    }
    function isEmpty(el){
      return !el || !String(el.value||'').trim();
    }

    // Validate on confirm click
    confirmBtn.addEventListener('click', function(e){
      var anyError = false;
      if(isEmpty(nameEl)){ show(nameEl, errName); anyError = true; } else { hide(nameEl, errName); }
      if(isEmpty(phoneEl)){ show(phoneEl, errPhone); anyError = true; } else { hide(phoneEl, errPhone); }
      if(isEmpty(depEl)){ show(depEl, errDep); anyError = true; } else { hide(depEl, errDep); }
      if(isEmpty(dstEl)){ show(dstEl, errDst); anyError = true; } else { hide(dstEl, errDst); }

      if(anyError){
        e.preventDefault();
        e.stopPropagation();
        // Focus the first invalid field
        try{
          (isEmpty(nameEl)&&nameEl || isEmpty(phoneEl)&&phoneEl || isEmpty(depEl)&&depEl || isEmpty(dstEl)&&dstEl).focus();
        }catch(_){}
        return false;
      }
      // else: proceed normally (no change to your flow)
    });

    // Clear per-field error on input
    [nameEl, phoneEl, depEl, dstEl].forEach(function(el, idx){
      if(!el) return;
      el.addEventListener('input', function(){
        if(el===nameEl) hide(nameEl, errName);
        else if(el===phoneEl) hide(phoneEl, errPhone);
        else if(el===depEl) hide(depEl, errDep);
        else if(el===dstEl) hide(dstEl, errDst);
      });
    });
  });
})();
</script>
<script>
(function(){
  function ready(fn){ if(document.readyState!=='loading'){ fn(); } else { document.addEventListener('DOMContentLoaded', fn); } }
  ready(function(){
    var confirmBtn = document.getElementById('confirmBtn') || document.querySelector('button[data-role="confirm"], .btn-confirm');
    if(!confirmBtn) return;

    var nameEl  = document.querySelector('#name, input[name="name"], #fullname, #fullName');
    var phoneEl = document.querySelector('#phone, input[name="phone"], #tel, input[type="tel"]');
    var depEl   = document.querySelector('#start, #depart, #origin, input[name="origin"], input[name="start"]');
    var dstEl   = document.querySelector('#end, #destination, #dest, input[name="destination"]');
    var dateEl  = document.querySelector('#date, input[type="date"]');

    function isEmpty(el){ return !el || !String(el.value||'').trim(); }

    function ensureErr(el, idSuffix, msg){
      if(!el) return null;
      var id = el.id ? (el.id + '-err') : ('field-' + idSuffix + '-err');
      var err = document.getElementById(id);
      if(!err){
        err = document.createElement('div');
        err.id = id;
        err.className = 'field-error';
        err.textContent = msg;
        if(el.parentNode){ el.parentNode.appendChild(err); }
      } else {
        err.textContent = msg;
      }
      return err;
    }

    var errName  = ensureErr(nameEl,  'name',  'Merci d’indiquer vos nom et prénom.');
    var errPhone = ensureErr(phoneEl, 'phone', 'Merci de renseigner votre numéro de téléphone.');
    var errDep   = ensureErr(depEl,   'start', 'Merci de préciser le lieu de départ.');
    var errDst   = ensureErr(dstEl,   'end',   'Merci de préciser la destination.');
    var errDate  = ensureErr(dateEl,  'date',  'Merci de sélectionner une date valide à partir d’aujourd’hui.');

    function show(el, err){ if(el&&err){ err.style.display='block'; el.classList.add('input-error'); } }
    function hide(el, err){ if(el&&err){ err.style.display='none'; el.classList.remove('input-error'); } }

    function isPastDate(el){
      if(!el || !el.value) return false; // no value: handled by native "required" if present; we focus on "inférieure à aujourd'hui"
      var v = String(el.value).trim();
      // Expecting YYYY-MM-DD
      var parts = v.split('-');
      if(parts.length !== 3) return true; // invalid format -> treat as invalid
      var y = parseInt(parts[0],10), m = parseInt(parts[1],10)-1, d = parseInt(parts[2],10);
      if(isNaN(y)||isNaN(m)||isNaN(d)) return true;
      var chosen = new Date(y, m, d);
      chosen.setHours(0,0,0,0);
      var today = new Date();
      today.setHours(0,0,0,0);
      return chosen < today;
    }

    function validateRequired(){
      var any=false;
      if(isEmpty(nameEl)){ show(nameEl, errName); any=true; } else { hide(nameEl, errName); }
      if(isEmpty(phoneEl)){ show(phoneEl, errPhone); any=true; } else { hide(phoneEl, errPhone); }
      if(isEmpty(depEl)){ show(depEl, errDep); any=true; } else { hide(depEl, errDep); }
      if(isEmpty(dstEl)){ show(dstEl, errDst); any=true; } else { hide(dstEl, errDst); }

      // Date check: show error if date < today (even if filled)
      if(dateEl){
        if(isPastDate(dateEl)){ show(dateEl, errDate); any=true; } else { hide(dateEl, errDate); }
      }
      return !any;
    }

    // Clear per-field error as user types/changes
    [nameEl, phoneEl, depEl, dstEl].forEach(function(el){
      if(!el) return;
      el.addEventListener('input', function(){
        var err = document.getElementById(el.id ? (el.id + '-err') : '');
        if(err){ err.style.display='none'; }
        el.classList.remove('input-error');
      });
    });
    if(dateEl){
      dateEl.addEventListener('change', function(){
        var id = dateEl.id ? (dateEl.id + '-err') : 'field-date-err';
        var err = document.getElementById(id);
        if(err){ err.style.display='none'; }
        dateEl.classList.remove('input-error');
      });
    }

    // Guard confirm
    confirmBtn.addEventListener('click', function(e){
      if(!validateRequired()){
        e.preventDefault();
        if(e.stopImmediatePropagation) e.stopImmediatePropagation();
        e.stopPropagation();
        return false;
      }
    }, true);

    // Also guard WA/Mail buttons if present
    document.addEventListener('click', function(e){
      var t = e.target;
      var waBtn = t.closest && (t.closest('#waBtn') || t.closest('[data-action="wa"]'));
      var mailBtn = t.closest && (t.closest('#mailBtn') || t.closest('[data-action="mail"]'));
      if(waBtn || mailBtn){
        if(!validateRequired()){
          e.preventDefault();
          if(e.stopImmediatePropagation) e.stopImmediatePropagation();
          e.stopPropagation();
          return false;
        }
      }
    }, true);
  });
})();
</script>
<script>
(function(){
  function ready(fn){ if(document.readyState!=='loading'){ fn(); } else { document.addEventListener('DOMContentLoaded', fn); } }
  ready(function(){
    var btn = document.getElementById('estimateBtn') || document.querySelector('.estimate-btn, button[data-action="estimate"]');
    if(!btn) return;

    var out = document.getElementById('estimateOut');
    if(!out){
      // fallback: create an output pill next to button if missing
      out = document.createElement('div'); out.id='estimateOut';
      out.style.display='inline-block'; out.style.marginLeft='10px'; out.style.padding='10px 12px';
      out.style.borderRadius='10px'; out.style.background='#f0f0f0'; out.style.minWidth='80px'; out.style.textAlign='center';
      btn.parentNode && btn.parentNode.appendChild(out);
    }

    function getVal(sel){
      var el = document.querySelector(sel);
      return el ? (el.value||'').trim() : '';
    }
    function getSelect(sel){
      var el = document.querySelector(sel);
      return el ? (el.value||'').trim() : '';
    }
    function parseWaitHours(){
      var waitSel = document.getElementById('waitOnTrip') || document.getElementById('waitDuring');
      var hoursSel = document.getElementById('waitHours');
      if(!waitSel || !hoursSel) return 0;
      if(hoursSel.disabled) return 0;
      return (String(waitSel.value).toLowerCase()==='oui') ? parseInt(hoursSel.value||'0',10)||0 : 0;
    }
    function isNight(dateStr, timeStr){
      // night if 19:00..23:59 or 00:00..06:59
      try{
        var parts = (timeStr||'').split(':');
        var h = parseInt(parts[0]||'0',10);
        if(isNaN(h)) return false;
        return (h >= 19 || h < 7);
      }catch(e){ return false; }
    }

    function pickTariff(isRoundTrip, night){
      // €/km based on rules provided earlier
      // A=1.03 (roundtrip day), B=1.55 (roundtrip night/holiday)
      // C=2.06 (one-way day), D=3.06 (one-way night/holiday)
      if(isRoundTrip){
        return night ? 1.55 : 1.03;
      }else{
        return night ? 3.06 : 2.06;
      }
    }

    function estimateWithDistanceMatrix(origin, destination, cb){
      if(!(window.google && google.maps && google.maps.DistanceMatrixService)){
        cb(new Error('Google DistanceMatrix non disponible'), null);
        return;
      }
      var service = new google.maps.DistanceMatrixService();
      service.getDistanceMatrix({
        origins: [origin],
        destinations: [destination],
        travelMode: google.maps.TravelMode.DRIVING,
        unitSystem: google.maps.UnitSystem.METRIC
      }, function(response, status){
        if(status !== 'OK' || !response || !response.rows || !response.rows[0] || !response.rows[0].elements || !response.rows[0].elements[0]){
          cb(new Error('DistanceMatrix status: '+status), null);
          return;
        }
        var el = response.rows[0].elements[0];
        if(el.status !== 'OK'){
          cb(new Error('Element status: '+el.status), null);
          return;
        }
        var meters = el.distance && el.distance.value;
        cb(null, (meters||0)/1000.0);
      });
    }

    btn.addEventListener('click', function(e){
      // If other validators block (missing fields), let them show errors;
      // we only proceed if origin & destination are present.
      var origin = getVal('#start, #depart, #origin, input[name="origin"], input[name="start"]');
      var destination = getVal('#end, #destination, #dest, input[name="destination"]');
      if(!origin || !destination){ return; }

      out.textContent = '…';

      var dateStr = getVal('#date, input[type="date"]');
      var timeStr = getVal('#time, input[type="time"]');
      var roundtripVal = getSelect('#roundtrip, #roundTrip');
      var isRoundTrip = (String(roundtripVal).toLowerCase()==='oui');
      var night = isNight(dateStr, timeStr);
      var perKm = pickTariff(isRoundTrip, night);
      var pickup = 3.75; // prise en charge
      var waitH = parseWaitHours();
      var waitPrice = (waitH>0 ? (25 * waitH) : 0);

      estimateWithDistanceMatrix(origin, destination, function(err, km){
        if(err){
          out.textContent = 'Erreur';
          return;
        }
        var totalKm = isRoundTrip ? (km * 2) : km;
        var total = pickup + (totalKm * perKm) + waitPrice;
        // round to 2 decimals
        total = Math.round(total * 100) / 100;
        out.textContent = total.toFixed(2) + ' €';
      });
    });
  });
})();
</script>
<script>
(function(){
  function ready(fn){ if(document.readyState!=='loading'){ fn(); } else { document.addEventListener('DOMContentLoaded', fn); } }
  ready(function(){
    var confirmBtn = document.getElementById('confirmBtn') || document.querySelector('button[data-role="confirm"], .btn-confirm');
    var phoneEl = document.querySelector('#phone, input[name="phone"], #tel, input[type="tel"]');
    var dateEl  = document.querySelector('#date, input[type="date"]');
    var timeEl  = document.querySelector('#time, input[type="time"]');

    function ensureErr(el, idSuffix, msg){
      if(!el) return null;
      var id = el.id ? el.id + '-err' : 'field-' + idSuffix + '-err';
      var box = document.getElementById(id);
      if(!box){
        box = document.createElement('div');
        box.id = id;
        box.className = 'field-error';
        box.style.display = 'none';
        box.textContent = msg;
        if(el.parentNode){ el.parentNode.appendChild(box); }
      } else {
        box.textContent = msg;
      }
      return box;
    }

    var errPhone = ensureErr(phoneEl, 'phone', 'Merci de renseigner un numéro de téléphone valide (chiffres uniquement).');
    var errTime  = ensureErr(timeEl,  'time',  'Merci de choisir une heure à partir de maintenant.');

    function show(el, box, msg){
      if(!el||!box) return;
      if(msg) box.textContent = msg;
      box.style.display = 'block';
      el.classList.add('input-error');
    }
    function hide(el, box){
      if(!el||!box) return;
      box.style.display = 'none';
      el.classList.remove('input-error');
    }

    function parseDate(val){
      if(!val) return null;
      var p = String(val).split('-'); if(p.length!==3) return null;
      var y=+p[0], m=+p[1]-1, d=+p[2]; if(isNaN(y)||isNaN(m)||isNaN(d)) return null;
      return new Date(y,m,d);
    }
    function parseTime(val){
      if(!val) return null;
      var p = String(val).split(':');
      var h=+p[0], mi=+p[1]||0; if(isNaN(h)||isNaN(mi)) return null;
      return {h:h, m:mi};
    }
    function isToday(d){
      var now=new Date();
      return d && d.getFullYear()===now.getFullYear() && d.getMonth()===now.getMonth() && d.getDate()===now.getDate();
    }
    function invalidTime(){
      if(!timeEl) return false;
      var t=parseTime(timeEl.value); if(!t) return false;
      var d=parseDate(dateEl && dateEl.value);
      if(d && isToday(d)){
        var now=new Date();
        var input=new Date(d.getFullYear(), d.getMonth(), d.getDate(), t.h, t.m, 0, 0);
        return input < now;
      }
      return false;
    }
    function invalidPhone(){
      if(!phoneEl) return false;
      var v=(phoneEl.value||'').trim();
      if(!v) return false;
      return /[A-Za-z]/.test(v);
    }

    function hasBlockingErrors(){
      var blocked=false;
      if(invalidPhone()){ show(phoneEl, errPhone); blocked=true; } else { hide(phoneEl, errPhone); }
      if(invalidTime()){ show(timeEl, errTime); blocked=true; } else { hide(timeEl, errTime); }
      return blocked;
    }

    function guard(e){
      if(hasBlockingErrors()){
        e.preventDefault();
        if(e.stopImmediatePropagation) e.stopImmediatePropagation();
        e.stopPropagation();
        return false;
      }
    }

    if(confirmBtn){ confirmBtn.addEventListener('click', guard, true); }
    document.addEventListener('click', function(e){
      var t=e.target;
      var waBtn = t.closest && (t.closest('#waBtn') || t.closest('[data-action="wa"]'));
      var mailBtn = t.closest && (t.closest('#mailBtn') || t.closest('[data-action="mail"]'));
      if(waBtn || mailBtn){ guard(e); }
    }, true);

    // Clear errors on edits
    if(phoneEl) phoneEl.addEventListener('input', function(){ if(!invalidPhone()) hide(phoneEl, errPhone); });
    if(timeEl)  timeEl.addEventListener('change', function(){ if(!invalidTime()) hide(timeEl, errTime); });
    if(dateEl)  dateEl.addEventListener('change', function(){ if(!invalidTime()) hide(timeEl, errTime); });
  });
})();
</script>
<script>
(function(){
  function ready(fn){ if(document.readyState!=='loading'){ fn(); } else { document.addEventListener('DOMContentLoaded', fn); } }
  ready(function(){
    // Tolerant selectors (do not change layout/ids)
    var phoneEl = document.querySelector('#phone, input[name="phone"], #tel, input[type="tel"]');
    var dateEl  = document.querySelector('#date, input[name="date"], input[type="date"]');
    var timeEl  = document.querySelector('#time, input[name="time"], input[type="time"]');
    var confirmBtn = document.getElementById('confirmBtn') || document.querySelector('button[data-role="confirm"], .btn-confirm');

    function ensureErr(el, idSuffix, msg){
      if(!el) return null;
      var id = el.id ? el.id + '-err' : 'field-' + idSuffix + '-err';
      var box = document.getElementById(id);
      if(!box){
        box = document.createElement('div');
        box.id = id;
        box.className = 'field-error';
        box.style.display = 'none';
        box.textContent = msg;
        if(el.parentNode){ el.parentNode.appendChild(box); }
      } else {
        box.textContent = msg;
      }
      return box;
    }
    var phoneErr = ensureErr(phoneEl, 'phone', 'Merci de renseigner un numéro de téléphone valide (chiffres uniquement).');
    var timeErr  = ensureErr(timeEl,  'time',  'Merci de choisir une heure à partir de maintenant.');

    function show(el, box, msg){
      if(!el||!box) return;
      if(msg) box.textContent = msg;
      box.style.display = 'block';
      el.classList.add('input-error');
    }
    function hide(el, box){
      if(!el||!box) return;
      box.style.display = 'none';
      el.classList.remove('input-error');
    }

    function invalidPhone(){
      if(!phoneEl) return false;
      var v = (phoneEl.value||'').trim();
      if(!v) return false; // empty handled by other "required" validators
      // Reject any letter, allow digits, spaces, +, -, (), .
      return /[A-Za-z]/.test(v);
    }

    function parseDate(val){
      if(!val) return null;
      var p = String(val).split('-');
      if(p.length!==3) return null;
      var y=+p[0], m=+p[1]-1, d=+p[2];
      if(isNaN(y)||isNaN(m)||isNaN(d)) return null;
      return new Date(y,m,d);
    }
    function parseTime(val){
      if(!val) return null;
      var p = String(val).split(':');
      var h=+p[0], mi=+p[1]||0;
      if(isNaN(h)||isNaN(mi)) return null;
      return {h:h, m:mi};
    }
    function isToday(d){
      var now = new Date();
      return d && d.getFullYear()===now.getFullYear() && d.getMonth()===now.getMonth() && d.getDate()===now.getDate();
    }
    function invalidTime(){
      if(!timeEl) return false;
      var t = parseTime(timeEl.value);
      if(!t) return false; // no time => other required validators handle it
      var d = parseDate(dateEl && dateEl.value);
      var now = new Date();
      if(d && isToday(d)){
        var input = new Date(d.getFullYear(), d.getMonth(), d.getDate(), t.h, t.m, 0, 0);
        return input < now;
      }
      return false;
    }

    function validateAndShow(){
      var bad = false;
      if(invalidPhone()){ show(phoneEl, phoneErr); bad = true; } else { hide(phoneEl, phoneErr); }
      if(invalidTime()){ show(timeEl, timeErr); bad = true; } else { hide(timeEl, timeErr); }
      return !bad;
    }

    // Real-time clearing of messages
    if(phoneEl){ phoneEl.addEventListener('input', function(){ if(!invalidPhone()) hide(phoneEl, phoneErr); }); }
    if(timeEl){ timeEl.addEventListener('change', function(){ if(!invalidTime()) hide(timeEl, timeErr); }); }
    if(dateEl){ dateEl.addEventListener('change', function(){ if(!invalidTime()) hide(timeEl, timeErr); }); }

    // Also validate on confirm click so the user sees errors even without interacting
    if(confirmBtn){
      confirmBtn.addEventListener('click', function(){
        validateAndShow();
      });
    }
  });
})();
</script>
<script>
(function(){
  function ready(fn){ if(document.readyState!=='loading'){ fn(); } else { document.addEventListener('DOMContentLoaded', fn); } }
  ready(function(){
    var phoneEl = document.querySelector('#phone, input[name="phone"], #tel, input[type="tel"]');
    var dateEl  = document.querySelector('#date, input[name="date"], input[type="date"]');
    var timeEl  = document.querySelector('#time, input[name="time"], input[type="time"]');
    var confirmBtn = document.getElementById('confirmBtn') || document.querySelector('button[data-role="confirm"], .btn-confirm');

    function getErr(el, idSuffix){
      if(!el) return null;
      var id = el.id ? el.id + '-err' : 'field-' + idSuffix + '-err';
      return document.getElementById(id);
    }
    function hasLettersPhone(){
      if(!phoneEl) return false;
      var v=(phoneEl.value||'').trim();
      if(!v) return false;
      return /[A-Za-z]/.test(v);
    }
    function parseDate(val){
      if(!val) return null;
      var p=String(val).split('-'); if(p.length!==3) return null;
      var y=+p[0], m=+p[1]-1, d=+p[2]; if(isNaN(y)||isNaN(m)||isNaN(d)) return null;
      return new Date(y,m,d);
    }
    function parseTime(val){
      if(!val) return null;
      var p=String(val).split(':');
      var h=+p[0], mi=+p[1]||0; if(isNaN(h)||isNaN(mi)) return null;
      return {h:h, m:mi};
    }
    function isToday(d){
      var now=new Date();
      return d && d.getFullYear()===now.getFullYear() && d.getMonth()===now.getMonth() && d.getDate()===now.getDate();
    }
    function timeInPast(){
      if(!timeEl) return false;
      var t=parseTime(timeEl.value); if(!t) return false;
      var d=parseDate(dateEl && dateEl.value);
      if(d && isToday(d)){
        var now=new Date();
        var input=new Date(d.getFullYear(), d.getMonth(), d.getDate(), t.h, t.m, 0, 0);
        return input < now;
      }
      return false;
    }

    function hasBlockingErrors(){
      var phoneErr = getErr(phoneEl,'phone');
      var timeErr  = getErr(timeEl,'time');
      var blocked=false;
      if(hasLettersPhone()){ if(phoneErr){ phoneErr.style.display='block'; } phoneEl && phoneEl.classList.add('input-error'); blocked=true; }
      if(timeInPast()){ if(timeErr){ timeErr.style.display='block'; } timeEl && timeEl.classList.add('input-error'); blocked=true; }
      return blocked;
    }

    function blockIfErrors(e){
      if(hasBlockingErrors()){
        e.preventDefault();
        if(e.stopImmediatePropagation) e.stopImmediatePropagation();
        e.stopPropagation();
        return false;
      }
    }

    if(confirmBtn){ confirmBtn.addEventListener('click', blockIfErrors, true); }

    document.addEventListener('click', function(e){
      var t = e.target;
      var waBtn = t.closest && (t.closest('#waBtn') || t.closest('[data-action="wa"]'));
      var mailBtn = t.closest && (t.closest('#mailBtn') || t.closest('[data-action="mail"]'));
      if(waBtn || mailBtn){ blockIfErrors(e); }
    }, true);
  });
})();
</script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  var phoneEl = document.querySelector('#phone, input[name="phone"], #tel, input[type="tel"]');
  var dateEl  = document.querySelector('#date, input[name="date"], input[type="date"]');
  var timeEl  = document.querySelector('#time, input[name="time"], input[type="time"]');
  var confirmBtn = document.getElementById('confirmBtn') || document.querySelector('button[data-role="confirm"], .btn-confirm');

  function ensureErr(el, idSuffix, msg){
    if(!el) return null;
    var id = el.id ? el.id + '-err' : 'field-' + idSuffix + '-err';
    var box = document.getElementById(id);
    if(!box){
      box = document.createElement('div');
      box.id = id;
      box.className = 'field-error';
      box.style.display = 'none';
      box.textContent = msg;
      if(el.parentNode){ el.parentNode.appendChild(box); }
    } else {
      box.textContent = msg;
    }
    return box;
  }

  var phoneErr = ensureErr(phoneEl, 'phone', 'Merci de renseigner un numéro de téléphone valide (chiffres uniquement).');
  var timeErr  = ensureErr(timeEl,  'time',  'Merci de choisir une heure à partir de maintenant.');

  function show(el, box){ if(el&&box){ box.style.display='block'; el.classList.add('input-error'); } }
  function hide(el, box){ if(el&&box){ box.style.display='none'; el.classList.remove('input-error'); } }

  function invalidPhone(){
    if(!phoneEl) return false;
    var v=(phoneEl.value||'').trim();
    if(!v) return false;
    return /[A-Za-z]/.test(v);
  }

  function parseDate(val){
    if(!val) return null;
    var p = String(val).split('-'); if(p.length!==3) return null;
    var y=+p[0], m=+p[1]-1, d=+p[2]; if(isNaN(y)||isNaN(m)||isNaN(d)) return null;
    return new Date(y,m,d);
  }
  function parseTime(val){
    if(!val) return null;
    var p = String(val).split(':');
    var h=+p[0], mi=+p[1]||0; if(isNaN(h)||isNaN(mi)) return null;
    return {h:h, m:mi};
  }
  function isToday(d){
    var now=new Date();
    return d && d.getFullYear()===now.getFullYear() && d.getMonth()===now.getMonth() && d.getDate()===now.getDate();
  }
  function invalidTime(){
    if(!timeEl) return false;
    var t=parseTime(timeEl.value); if(!t) return false;
    var d=parseDate(dateEl && dateEl.value);
    if(d && isToday(d)){
      var now=new Date();
      var input=new Date(d.getFullYear(), d.getMonth(), d.getDate(), t.h, t.m, 0, 0);
      return input < now;
    }
    return false;
  }

  function showErrors(){
    if(invalidPhone()){ show(phoneEl, phoneErr); } else { hide(phoneEl, phoneErr); }
    if(invalidTime()){ show(timeEl, timeErr); } else { hide(timeEl, timeErr); }
  }

  // Hook events
  if(confirmBtn){ confirmBtn.addEventListener('click', showErrors); }
  if(phoneEl){ phoneEl.addEventListener('input', function(){ if(!invalidPhone()) hide(phoneEl, phoneErr); }); }
  if(timeEl){ timeEl.addEventListener('change', function(){ if(!invalidTime()) hide(timeEl, timeErr); }); }
  if(dateEl){ dateEl.addEventListener('change', function(){ if(!invalidTime()) hide(timeEl, timeErr); }); }
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  var phoneEl = document.querySelector('#phone, input[name="phone"], #tel, input[type="tel"]');
  var dateEl  = document.querySelector('#date, input[name="date"], input[type="date"]');
  var timeEl  = document.querySelector('#time, input[name="time"], input[type="time"]');

  function ensureErr(el, idSuffix, msg){
    if(!el) return null;
    var id = el.id ? el.id + '-err' : 'field-' + idSuffix + '-err';
    var box = document.getElementById(id);
    if(!box){
      box = document.createElement('div');
      box.id = id;
      box.className = 'field-error';
      box.style.display = 'none';
      box.textContent = msg;
      if(el.parentNode){ el.parentNode.appendChild(box); }
    }
    return box;
  }
  var phoneErr = ensureErr(phoneEl, 'phone', 'Merci de renseigner un numéro de téléphone valide (chiffres uniquement).');
  var timeErr  = ensureErr(timeEl,  'time',  'Merci de choisir une heure à partir de maintenant.');

  function show(el, box){ if(el&&box){ box.style.display='block'; el.classList.add('input-error'); } }
  function hide(el, box){ if(el&&box){ box.style.display='none'; el.classList.remove('input-error'); } }

  function invalidPhone(){
    if(!phoneEl) return false;
    var v=(phoneEl.value||'').trim();
    if(!v) return false;
    return /[A-Za-z]/.test(v);
  }
  function parseDate(val){
    if(!val) return null;
    var p=String(val).split('-'); if(p.length!==3) return null;
    var y=+p[0], m=+p[1]-1, d=+p[2]; if(isNaN(y)||isNaN(m)||isNaN(d)) return null;
    return new Date(y,m,d);
  }
  function parseTime(val){
    if(!val) return null;
    var p=String(val).split(':');
    var h=+p[0], mi=+p[1]||0; if(isNaN(h)||isNaN(mi)) return null;
    return {h:h, m:mi};
  }
  function isToday(d){
    var now=new Date();
    return d && d.getFullYear()===now.getFullYear() && d.getMonth()===now.getMonth() && d.getDate()===now.getDate();
  }
  function invalidTime(){
    if(!timeEl) return false;
    var t=parseTime(timeEl.value); if(!t) return false;
    var d=parseDate(dateEl && dateEl.value);
    if(d && isToday(d)){
      var now=new Date();
      var input=new Date(d.getFullYear(), d.getMonth(), d.getDate(), t.h, t.m, 0, 0);
      return input < now;
    }
    return false;
  }

  // Live validation
  if(phoneEl){
    phoneEl.addEventListener('input', function(){
      if(invalidPhone()){ show(phoneEl, phoneErr); } else { hide(phoneEl, phoneErr); }
    });
  }
  function checkTime(){ if(invalidTime()){ show(timeEl, timeErr); } else { hide(timeEl, timeErr); } }
  if(timeEl){ timeEl.addEventListener('input', checkTime); timeEl.addEventListener('change', checkTime); }
  if(dateEl){ dateEl.addEventListener('change', checkTime); }

  // Initial check on load in case fields are prefilled
  checkTime();
  if(invalidPhone()){ show(phoneEl, phoneErr); } else { hide(phoneEl, phoneErr); }
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  function scrollToFirstError(){
    // 1) Prefer a visible .field-error
    var err = Array.from(document.querySelectorAll('.field-error')).find(function(n){
      return n && n.style && n.style.display !== 'none' && n.offsetParent !== null;
    });
    if(err && err.scrollIntoView){ err.scrollIntoView({behavior:'smooth', block:'center'}); return true; }
    // 2) Fallback to first input with .input-error
    var bad = document.querySelector('.input-error');
    if(bad && bad.scrollIntoView){ bad.scrollIntoView({behavior:'smooth', block:'center'}); return true; }
    return false;
  }

  function hookClick(sel){
    var el = document.querySelector(sel);
    if(!el) return;
    el.addEventListener('click', function(){
      // Wait a tick so validators can show messages, then scroll
      setTimeout(scrollToFirstError, 50);
    }, true);
  }

  // Hook main actions
  hookClick('#confirmBtn');
  hookClick('button[data-role="confirm"]');
  hookClick('.btn-confirm');
  // Also hook possible WhatsApp / Mail
  document.addEventListener('click', function(e){
    var t = e.target;
    var waBtn = t.closest && (t.closest('#waBtn') || t.closest('[data-action="wa"]'));
    var mailBtn = t.closest && (t.closest('#mailBtn') || t.closest('[data-action="mail"]'));
    if(waBtn || mailBtn){
      setTimeout(scrollToFirstError, 50);
    }
  }, true);
});
</script>
<script id="alpha-autoclean-js">
(function(){
  function ready(fn){ if(document.readyState!=='loading'){fn()} else document.addEventListener('DOMContentLoaded',fn); }
  ready(function(){
    var nameInput = document.getElementById('name');
    if(!nameInput) return;
    var err = document.getElementById('nameError');
    // Autorisés: lettres (avec accents) + espaces
    // On supprime instantanément tout le reste
    function cleanAndNotify(){
      var before = nameInput.value;
      // Remplacer tout caractère NON lettre/espaces par rien
      var after = before.replace(/[^\p{L}\s]/gu, '');
      if(after !== before){
        nameInput.value = after;
        if(err){ err.style.display='block'; }
        nameInput.classList.add('input-invalid');
      }else{
        if(err){ err.style.display='none'; }
        nameInput.classList.remove('input-invalid');
      }
    }
    nameInput.addEventListener('input', cleanAndNotify);
    nameInput.addEventListener('blur', cleanAndNotify);
  });
})();
</script>
<script id="phone-autoclean-js-v2">
(function(){
  function ready(fn){ if(document.readyState!=='loading'){fn()} else document.addEventListener('DOMContentLoaded',fn); }
  ready(function(){
    var phone = document.getElementById('phone');
    var err = document.getElementById('phoneError');
    if(!phone) return;

    function cleanPhone(){
      var before = phone.value || '';
      // Autoriser uniquement chiffres et '+' (peu importe la position)
      var after = before.replace(/[^0-9+]+/g, '');
      var changed = (after !== before);
      if(changed) phone.value = after;

      // Valide si ne contient QUE chiffres et '+'
      var ok = /^[0-9+]*$/.test(phone.value);

      if(changed || !ok){
        if(err) err.style.display = 'block';
        phone.classList.add('input-invalid');
      }else{
        if(err) err.style.display = 'none';
        phone.classList.remove('input-invalid');
      }
    }

    phone.addEventListener('input', cleanPhone);
    phone.addEventListener('blur', cleanPhone);
    // Première passe
    cleanPhone();
  });
})();
</script>
<script id="name-accents-date-min-js">
(function(){
  function ready(fn){ if(document.readyState!=='loading'){fn()} else document.addEventListener('DOMContentLoaded',fn); }
  ready(function(){
    // NOM avec accents: autoriser lettres (Unicode) + espaces; supprimer le reste immédiatement
    var nameInput = document.getElementById('name');
    var nameErr = document.getElementById('nameAlphaError');
    function cleanName(){
      if(!nameInput) return;
      var before = nameInput.value || '';
      var after = before.replace(/[^\p{L}\s]/gu, ''); // \p{L} = lettres (accents inclus), \s = espaces
      var changed = after !== before;
      if(changed) nameInput.value = after;
      var ok = /^[\p{L}\s]*$/u.test(nameInput.value);
      if(changed || (!ok && nameInput.value.length)){
        if(nameErr) nameErr.style.display = 'block';
        nameInput.classList.add('input-invalid');
      } else {
        if(nameErr) nameErr.style.display = 'none';
        nameInput.classList.remove('input-invalid');
      }
    }
    if(nameInput){
      nameInput.addEventListener('input', cleanName);
      nameInput.addEventListener('blur', cleanName);
      cleanName();
    }

    // DATE: bloquer dates passées (min=today) + message et reset si besoin
    var dateInput = document.getElementById('date');
    var dateErr = document.getElementById('dateErrorMin');
    function toYMD(d){
      var y = d.getFullYear();
      var m = String(d.getMonth()+1).padStart(2,'0');
      var dd = String(d.getDate()).padStart(2,'0');
      return y + '-' + m + '-' + dd;
    }
    function setMinToday(){
      var t = new Date(); t.setHours(0,0,0,0);
      if(dateInput) dateInput.setAttribute('min', toYMD(t));
    }
    function validateDate(){
      if(!dateInput) return true;
      var v = dateInput.value;
      if(!v){
        if(dateErr) dateErr.style.display='none';
        dateInput.classList.remove('input-invalid');
        return true;
      }
      var parts = v.split('-');
      if(parts.length===3){
        var d = new Date(+parts[0], +parts[1]-1, +parts[2]); d.setHours(0,0,0,0);
        var t = new Date(); t.setHours(0,0,0,0);
        if(d < t){
          if(dateErr) dateErr.style.display='block';
          dateInput.classList.add('input-invalid');
          // remettre à aujourd'hui pour éviter la date passée
          dateInput.value = toYMD(t);
          return false;
        }
      }
      if(dateErr) dateErr.style.display='none';
      dateInput.classList.remove('input-invalid');
      return true;
    }
    setMinToday();
    if(dateInput){
      dateInput.addEventListener('change', validateDate);
      dateInput.addEventListener('blur', validateDate);
      validateDate();
    }
  });
})();
</script>
<script id="time-now-guard-js">
(function () {
  const timeInput =
    document.querySelector('#time, #heure, input[type="time"][name*="heure" i]') ||
    document.querySelector('input[type="time"]');
  if (!timeInput) return;

  const dateInput =
    document.querySelector('#date, input[type="date"][name*="date" i]') ||
    document.querySelector('input[type="date"]');

  function nowHHMM() {
    const d = new Date();
    const h = String(d.getHours()).padStart(2, '0');
    const m = String(d.getMinutes()).padStart(2, '0');
    return `${h}:${m}`;
  }

  function ensureErrorEl() {
    let el = document.getElementById('timeError');
    if (!el) {
      el = document.createElement('div');
      el.id = 'timeError';
      el.style.color = '#d32f2f';
      el.style.fontSize = '0.92rem';
      el.style.marginTop = '6px';
      el.style.display = 'none';
      timeInput.insertAdjacentElement('afterend', el);
    }
    return el;
  }
  const errorEl = ensureErrorEl();
  // Effacer tout message au démarrage
  errorEl.style.display = 'none';
  timeInput.classList.remove('input-invalid', 'input-error', 'is-invalid');

  function parseDate(value) {
    if (!value) return null;
    if (value.includes('/')) {
      const [dd, mm, yyyy] = value.split('/');
      const d = new Date(+yyyy, +mm - 1, +dd, 0, 0, 0, 0);
      return isNaN(d.getTime()) ? null : d;
    }
    if (value.includes('-')) {
      const [yyyy, mm, dd] = value.split('-');
      const d = new Date(+yyyy, +mm - 1, +dd, 0, 0, 0, 0);
      return isNaN(d.getTime()) ? null : d;
    }
    return null;
  }

  function sameDay(a, b) {
    return a.getFullYear() === b.getFullYear() &&
           a.getMonth() === b.getMonth() &&
           a.getDate() === b.getDate();
  }

  function showErr() {
    errorEl.textContent = "Veuillez choisir une heure plus en avance que l'heure actuelle. Merci pour votre compréhension.";
    errorEl.style.display = 'block';
    timeInput.classList.add('input-invalid');
  }
  function hideErr() {
    errorEl.style.display = 'none';
    timeInput.classList.remove('input-invalid');
  }

  function validateAndMaybeReset() {
    if (!timeInput.value) { hideErr(); return true; }

    let isToday = true;
    if (dateInput && dateInput.value) {
      const sel = parseDate(dateInput.value);
      const today = new Date(); today.setHours(0,0,0,0);
      if (sel) {
        const sel0 = new Date(sel.getFullYear(), sel.getMonth(), sel.getDate(), 0,0,0,0);
        isToday = sel0.getTime() === today.getTime();
      }
    }

    if (isToday) {
      const now = nowHHMM();
      const chosen = timeInput.value;
      if (chosen <= now) {
        showErr();
        // Réinitialise à l'heure actuelle
        timeInput.value = now;
        return false;
      }
    }
    hideErr();
    return true;
  }

  // Valider au changement / blur (pas au chargement)
  timeInput.addEventListener('change', validateAndMaybeReset);
  timeInput.addEventListener('blur', validateAndMaybeReset);

  // Revalider sur actions (si présents)
  ['#btn-estimation', '#btn-reserver', '#btn-whatsapp', '#btn-email'].forEach(sel => {
    const b = document.querySelector(sel);
    if (b) {
      b.addEventListener('click', () => validateAndMaybeReset());
    }
  });
})();
</script>


<script id="wait-ui-toggle-js">
(function(){
  function ready(fn){ if(document.readyState!=='loading'){fn()} else document.addEventListener('DOMContentLoaded',fn); }
  ready(function(){
    function $(sel){ return document.querySelector(sel); }
    function $all(sel){ return Array.from(document.querySelectorAll(sel)); }

    // Try to detect the toggle and duration input
    var waitToggleInput = document.getElementById('waitToggle') || document.querySelector('input[name="attente"]');
    var waitGroup = document.getElementById('waitToggleGroup') || document.querySelector('.wait-toggle') || document.querySelector('.btn-group');
    var waitHours = document.getElementById('waitHours') || $('#dureeAttente') || $all('select,input').find(function(el){
      var p=(el.getAttribute('placeholder')||'').toLowerCase();
      return p.includes('durée') || p.includes('duree');
    });

    // Helper to know if waiting is enabled
    function isWaitingOn(){
      // native inputs
      if(waitToggleInput){
        if(waitToggleInput.type==='checkbox') return !!waitToggleInput.checked;
        if(waitToggleInput.type==='radio'){
          var y = document.querySelector('input[name="attente"][value="yes"], input[name="attente"][value="oui"]');
          if(y) return !!y.checked;
        }
      }
      // aria-pressed buttons
      if(waitGroup){
        var active = waitGroup.querySelector('[aria-pressed="true"], .active');
        if(active){ return /oui/i.test((active.textContent||'')); }
      }
      // defaults to false
      return false;
    }

    function setDisabled(on){
      if(!waitHours) return;
      if(on){
        waitHours.setAttribute('disabled','disabled');
        // force 0 quand désactivé
        if(waitHours.tagName.toLowerCase()==='select'){
          // Chercher une option valeur "0" ou en créer une temporaire
          var opt0 = waitHours.querySelector('option[value="0"]');
          if(!opt0){
            opt0 = document.createElement('option');
            opt0.value = "0";
            opt0.textContent = "0";
            opt0.dataset.temp = "1";
            waitHours.insertBefore(opt0, waitHours.firstChild);
          }
          waitHours.value = "0";
        } else {
          waitHours.value = "0";
        }
        waitHours.classList.add('is-disabled');
      } else {
        waitHours.removeAttribute('disabled');
        waitHours.classList.remove('is-disabled');
        // si select, s'assurer que les valeurs 1..4 existent
        if(waitHours.tagName.toLowerCase()==='select'){
          // Supprimer l'option temporaire 0 si on ne la veut que quand c'est désactivé
          var temp = waitHours.querySelector('option[data-temp="1"]');
          if(temp) temp.remove();
          // S'il n'y a pas d'options 1..4, on les ajoute (sans dupliquer)
          var need = [];
          for(var i=1;i<=4;i++){
            if(!waitHours.querySelector('option[value="'+i+'"]')) need.push(i);
          }
          need.forEach(function(i){
            var opt = document.createElement('option');
            opt.value = String(i);
            opt.textContent = String(i);
            waitHours.appendChild(opt);
          });
          // si valeur actuelle = 0, proposer 1 par défaut
          if(waitHours.value === "0"){ waitHours.value = "1"; }
        }
      }
    }

    function syncUI(){
      var on = !isWaitingOn(); // on = disabled state when waiting is OFF
      setDisabled(on);
    }

    // Initial
    syncUI();

    // Bind changes
    if(waitToggleInput){
      waitToggleInput.addEventListener('change', syncUI);
    }
    if(waitGroup){
      // capture clicks on group buttons
      $all('button, [role="button"], .btn', waitGroup).forEach(function(btn){
        btn.addEventListener('click', function(){
          // petit délai pour que la classe .active / aria-pressed se mette à jour
          setTimeout(syncUI, 50);
        });
      });
    }
  });
})();
</script>

<script id="wa-mail-validate-js">
(function(){
  function ready(fn){ if(document.readyState!=='loading'){fn()} else document.addEventListener('DOMContentLoaded',fn); }
  ready(function(){
    function $(sel){ return document.querySelector(sel); }
    function $all(sel){ return Array.from(document.querySelectorAll(sel)); }

    // Cache inputs (robuste: id, label, placeholder)
    function findByLabelText(text){
      text = text.toLowerCase();
      var labels = $all('label');
      for(var i=0;i<labels.length;i++){
        var t = (labels[i].textContent||'').toLowerCase();
        if(t.includes(text)){
          var inp = labels[i].querySelector('input,textarea,select');
          if(inp) return inp;
        }
      }
      return null;
    }
    function findByPlaceholder(part){
      part = part.toLowerCase();
      var inputs = $all('input,textarea');
      return inputs.find(function(el){
        return ((el.getAttribute('placeholder')||'').toLowerCase().includes(part));
      }) || null;
    }

    var nameInput  = $('#name') || findByLabelText('nom') || findByPlaceholder('nom');
    var phoneInput = $('#phone') || findByLabelText('téléphone') || findByPlaceholder('tél') || findByPlaceholder('phone');
    var dateInput  = $('#date') || document.querySelector('input[type="date"]');
    var timeInput  = $('#time') || document.querySelector('input[type="time"]');
    var startInput = $('#start') || findByLabelText('lieu de départ') || findByPlaceholder('départ') || findByPlaceholder('depart');
    var endInput   = $('#end')   || findByLabelText('destination')    || findByPlaceholder('destination');

    // Effacer le message sous "heure" au démarrage
    var timeErr = document.getElementById('timeError') || document.getElementById('timeErrorNow');
    if(timeErr){ timeErr.style.display = 'none'; }
    if(timeInput){ timeInput.classList.remove('input-invalid','input-error','is-invalid'); }

    // Fabrique un "petit message rouge" sous un champ si absent
    function ensureFieldError(input){
      if(!input) return null;
      var sib = input.nextElementSibling;
      if(sib && sib.classList && sib.classList.contains('field-error')) return sib;
      var d = document.createElement('div');
      d.className = 'field-error';
      d.style.display = 'none';
      input.insertAdjacentElement('afterend', d);
      return d;
    }
    var errName = ensureFieldError(nameInput);
    var errPhone = ensureFieldError(phoneInput);
    var errDate = ensureFieldError(dateInput);
    var errTime = ensureFieldError(timeInput);
    var errStart = ensureFieldError(startInput);
    var errEnd = ensureFieldError(endInput);

    // Global banner near buttons
    function ensureGlobalError(){
      var banner = document.getElementById('globalFormError');
      if(!banner){
        // place it right above the action buttons area if possible
        var anchor = document.getElementById('btn-whatsapp') || document.getElementById('btn-email') ||
                     $all('a,button').find(el => /réserver par whatsapp/i.test((el.textContent||''))) ||
                     $all('a,button').find(el => /réserver par e-?mail/i.test((el.textContent||''))) ||
                     document.body;
        banner = document.createElement('div');
        banner.id = 'globalFormError';
        banner.className = 'form-global-error';
        banner.style.display = 'none';
        anchor.parentNode.insertBefore(banner, anchor);
      }
      return banner;
    }
    var globalErr = ensureGlobalError();

    function setErr(input, holder, msg){
      if(!input||!holder) return;
      holder.textContent = msg;
      holder.style.display = 'block';
      input.classList.add('input-invalid');
    }
    function clearErr(input, holder){
      if(holder){ holder.style.display='none'; holder.textContent=''; }
      if(input){ input.classList.remove('input-invalid'); }
    }

    // Validation du champ Heure selon ta règle (<= maintenant -> erreur + message demandé)
    function nowHM(){
      var d = new Date();
      return String(d.getHours()).padStart(2,'0') + ':' + String(d.getMinutes()).padStart(2,'0');
    }
    function isTodaySelected(){
      if(!dateInput || !dateInput.value) return false;
      var v=dateInput.value;
      var d;
      if(v.includes('/')){ // JJ/MM/AAAA
        var p=v.split('/'); d=new Date(+p[2], +p[1]-1, +p[0]); 
      }else{ // AAAA-MM-JJ
        var p=v.split('-'); d=new Date(+p[0], +p[1]-1, +p[2]);
      }
      var t=new Date(); t.setHours(0,0,0,0);
      d && d.setHours(0,0,0,0);
      return d && d.getTime()===t.getTime();
    }
    function validateTimeField(){
      if(!timeInput) return true;
      // Ne rien afficher au démarrage si vide
      if(!timeInput.value){ clearErr(timeInput, errTime); return true; }
      if(isTodaySelected()){
        if(timeInput.value <= nowHM()){
          setErr(timeInput, errTime, "Veuillez choisir une heure plus en avance que l'heure actuelle. Merci pour votre compréhension.");
          return false;
        }
      }
      clearErr(timeInput, errTime);
      return true;
    }

    function validateAll(showMsgs){
      var missing = [];

      // Nom
      if(nameInput){
        var v=(nameInput.value||'').trim();
        if(!v){ missing.push('Nom et prénoms'); if(showMsgs) setErr(nameInput, errName, "Veuillez renseigner votre nom et prénoms."); }
        else if(nameInput.classList.contains('input-invalid')){ missing.push('Nom et prénoms'); if(showMsgs) setErr(nameInput, errName, "Veuillez corriger votre nom (lettres uniquement, accents et espaces autorisés)."); }
        else clearErr(nameInput, errName);
      }
      // Téléphone
      if(phoneInput){
        var pv=(phoneInput.value||'').trim();
        if(!pv){ missing.push('Téléphone'); if(showMsgs) setErr(phoneInput, errPhone, "Veuillez saisir votre numéro de téléphone."); }
        else if(phoneInput.classList.contains('input-invalid')){ missing.push('Téléphone'); if(showMsgs) setErr(phoneInput, errPhone, "Numéro invalide. Chiffres (et « + ») uniquement."); }
        else clearErr(phoneInput, errPhone);
      }
      // Date
      if(dateInput){
        var dv=(dateInput.value||'').trim();
        if(!dv){ missing.push('Date'); if(showMsgs) setErr(dateInput, errDate, "Veuillez sélectionner une date."); }
        else if(dateInput.classList.contains('input-invalid')){ missing.push('Date'); if(showMsgs) setErr(dateInput, errDate, "La date choisie n'est pas valide."); }
        else clearErr(dateInput, errDate);
      }
      // Heure
      var timeOK = validateTimeField();
      if(!timeOK){ missing.push('Heure'); }

      // Lieux
      if(startInput){
        var sv=(startInput.value||'').trim();
        if(!sv){ missing.push('Lieu de départ'); if(showMsgs) setErr(startInput, errStart, "Veuillez renseigner le lieu de départ."); }
        else clearErr(startInput, errStart);
      }
      if(endInput){
        var ev=(endInput.value||'').trim();
        if(!ev){ missing.push('Destination'); if(showMsgs) setErr(endInput, errEnd, "Veuillez renseigner la destination."); }
        else clearErr(endInput, errEnd);
      }

      return missing;
    }

    function showGlobal(miss){
      if(!globalErr) return;
      if(!miss.length){ globalErr.style.display='none'; globalErr.textContent=''; return; }
      globalErr.textContent = "Merci de compléter/rectifier : " + miss.join(", ") + ".";
      globalErr.style.display = 'block';
      try{ globalErr.scrollIntoView({behavior:'smooth', block:'center'}); }catch(_){}
    }

    // Trouver les boutons "Réserver par WhatsApp" et "Réserver par e-mail"
    function findActions(){
      var all = $all('a,button');
      var wa = all.find(el => /réserver par whatsapp/i.test((el.textContent||'').trim())) || all.find(el => (el.href||'').includes('wa.me'));
      var mail = all.find(el => /réserver par e-?mail/i.test((el.textContent||'').trim())) || all.find(el => (el.href||'').startsWith('mailto:'));
      return {wa, mail};
    }
    var actions = findActions();

    function guardClick(e){
      var missing = validateAll(true);
      if(missing.length){
        e.preventDefault();
        e.stopPropagation();
        showGlobal(missing);
      } else {
        showGlobal([]);
      }
    }

    if(actions.wa){ actions.wa.addEventListener('click', guardClick, true); }
    if(actions.mail){ actions.mail.addEventListener('click', guardClick, true); }

    // Et on cache le message de l'heure au démarrage (exigence)
    if(timeErr){ timeErr.style.display='none'; }
  });
})();
</script>


<script id="estimation-reprogram-js">
(function(){
  function ready(fn){ if(document.readyState!=='loading'){fn()} else document.addEventListener('DOMContentLoaded',fn); }
  ready(function(){
    // ---- Tarifs ----
    var RATE_A = 1.03; // AR jour
    var RATE_B = 1.55; // AR nuit/jour férié
    var RATE_C = 1.03; // Simple jour
    var RATE_D = 1.55; // Simple nuit/jour férié
    var BASE_FEE = 3.75;
    var WAIT_PER_HOUR = 25;

    // Permet la surcharge via data-* sur <body>
    try{
      var b = document.body;
      if(b.dataset.rateA) RATE_A = parseFloat(String(b.dataset.rateA).replace(',','.'))||RATE_A;
      if(b.dataset.rateB) RATE_B = parseFloat(String(b.dataset.rateB).replace(',','.'))||RATE_B;
      if(b.dataset.rateC) RATE_C = parseFloat(String(b.dataset.rateC).replace(',','.'))||RATE_C;
      if(b.dataset.rateD) RATE_D = parseFloat(String(b.dataset.rateD).replace(',','.'))||RATE_D;
      if(b.dataset.baseFee) BASE_FEE = parseFloat(String(b.dataset.baseFee).replace(',','.'))||BASE_FEE;
      if(b.dataset.waitHour) WAIT_PER_HOUR = parseFloat(String(b.dataset.waitHour).replace(',','.'))||WAIT_PER_HOUR;
    }catch(_){}

    // ---- Helpers ----
    function $(sel){ return document.querySelector(sel); }
    function $all(sel){ return Array.from(document.querySelectorAll(sel)); }
    function parseNum(v){ var n=parseFloat(String(v).replace(',','.')); return isNaN(n)?0:n; }

    // Champs
    var dateInput  = $('#date') || document.querySelector('input[type="date"]');
    var timeInput  = $('#time') || document.querySelector('input[type="time"]');
    var waitHours  = $('#waitHours') || $('#dureeAttente') || $all('select').find(s=>/attente|durée|duree/i.test(s.outerHTML));
    var priceOut   = $('#estimationPrice') || (function(){ var s=document.createElement('span'); s.id='estimationPrice'; s.style.marginLeft='10px'; s.style.fontWeight='700'; return s; })();
    var estBtn     = $('#btn-estimation') || $all('button,a').find(el=>/estimation du prix|estimer|estimation/i.test((el.textContent||'').toLowerCase()));

    if(estBtn && !priceOut.parentNode){ estBtn.insertAdjacentElement('afterend', priceOut); }

    // Détection Aller/retour
    function isRoundTrip(){
      var rt = document.getElementById('roundTrip') || document.querySelector('input[name="roundTrip"]');
      if(rt){
        if(rt.type==='checkbox') return !!rt.checked;
        if(rt.type==='radio'){
          var yes = document.querySelector('input[name="roundTrip"][value="yes"], input[name="roundTrip"][value="oui"]');
          if(yes) return !!yes.checked;
        }
      }
      // Btn group
      var group = document.getElementById('roundTripGroup') || document.querySelector('.roundtrip-toggle') || document.querySelector('.btn-group');
      if(group){
        var act = group.querySelector('[aria-pressed="true"], .active');
        if(act) return /oui/i.test((act.textContent||''));
      }
      // Texte "Oui" actif proche
      var yesEl = $all('button,label,span').find(el=>/^\s*oui\s*$/i.test((el.textContent||'')) && (el.classList.contains('active')||el.getAttribute('aria-pressed')==='true'));
      return !!yesEl;
    }

    // Attente activée ?
    function isWaitingOn(){
      var att = document.getElementById('waitToggle') || document.querySelector('input[name="attente"]');
      if(att){
        if(att.type==='checkbox') return !!att.checked;
        if(att.type==='radio'){
          var y = document.querySelector('input[name="attente"][value="yes"], input[name="attente"][value="oui"]');
          if(y) return !!y.checked;
        }
      }
      var grp = document.getElementById('waitToggleGroup') || document.querySelector('.wait-toggle') || document.querySelector('.btn-group');
      if(grp){
        var act = grp.querySelector('[aria-pressed="true"], .active');
        if(act) return /oui/i.test((act.textContent||''));
      }
      return false;
    }

    // Forcer l'UI de durée en fonction du toggle (fix "toujours grisé")
    function syncWaitUI(){
      if(!waitHours) return;
      if(isWaitingOn()){
        waitHours.removeAttribute('disabled');
        waitHours.classList.remove('is-disabled');
        // si 0 → proposer 1 par défaut
        if(waitHours.value === "0" || waitHours.value === "" || waitHours.value == null){
          // s'assurer que les options 1..4 existent
          if(waitHours.tagName.toLowerCase()==='select'){
            for(var i=1;i<=4;i++){
              if(!waitHours.querySelector('option[value="'+i+'"]')){
                var opt=document.createElement('option'); opt.value=String(i); opt.textContent=String(i); waitHours.appendChild(opt);
              }
            }
          }
          waitHours.value = "1";
        }
      } else {
        waitHours.setAttribute('disabled','disabled');
        waitHours.classList.add('is-disabled');
        if(waitHours.tagName.toLowerCase()==='select'){
          var opt0 = waitHours.querySelector('option[value="0"]');
          if(!opt0){
            opt0 = document.createElement('option'); opt0.value="0"; opt0.textContent="0"; opt0.dataset.temp="1";
            waitHours.insertBefore(opt0, waitHours.firstChild);
          }
          waitHours.value = "0";
        } else {
          waitHours.value = "0";
        }
      }
    }

    // Événements pour resynchroniser l'UI
    $all('#waitToggle, input[name="attente"]').forEach(function(el){
      el.addEventListener('change', function(){ setTimeout(syncWaitUI, 30); });
    });
    var waitGroup = document.getElementById('waitToggleGroup') || document.querySelector('.wait-toggle') || document.querySelector('.btn-group');
    if(waitGroup){
      waitGroup.addEventListener('click', function(){ setTimeout(syncWaitUI, 30); });
    }
    // Sync initial
    syncWaitUI();

    // Distance en km (chercher plusieurs sources)
    function getDistanceKm(){
      var el = document.getElementById('distanceKm') || document.querySelector('[data-distance-km]');
      if(el){
        var v = el.getAttribute('data-distance-km') || el.textContent || el.value || '';
        var n = parseNum(v);
        if(n>0) return n;
      }
      var kmNode = $all('span,div,p').find(function(n){
        var t=(n.textContent||'').toLowerCase();
        return /\d+([.,]\d+)?\s*km/.test(t);
      });
      if(kmNode){
        var m = (kmNode.textContent||'').match(/(\d+(?:[.,]\d+)?)\s*km/i);
        if(m){ return parseNum(m[1]); }
      }
      if(typeof window.currentDistanceKm === 'number') return window.currentDistanceKm;
      return 0;
    }

    function isNight(){
      if(!timeInput || !timeInput.value) return false;
      var hh = parseInt(timeInput.value.split(':')[0],10);
      if(isNaN(hh)) return false;
      return (hh>=19 || hh<7);
    }

    function getWaitHours(){
      if(!isWaitingOn()) return 0;
      if(!waitHours) return 0;
      var n = parseInt((waitHours.value||'0'),10);
      if(isNaN(n)) n = 0;
      // bornes 1..4 si attente activée
      if(n<1) n=1;
      if(n>4) n=4;
      return n;
    }

    function computePrice(){
      var dist = getDistanceKm();
      if(!dist || dist<=0) return null;

      var rt = isRoundTrip();
      var night = isNight();

      var perKm = rt ? (night ? RATE_B : RATE_A) : (night ? RATE_D : RATE_C);
      var totalKm = rt ? dist*2 : dist;
      var waitH = getWaitHours();

      var price = (totalKm * perKm) + BASE_FEE + (waitH * WAIT_PER_HOUR);
      return Math.round(price*100)/100;
    }

    function showPrice(){
      var p = computePrice();
      if(p==null){
        // Pas de distance trouvée -> afficher une petite aide
        if(priceOut){ priceOut.textContent = " (entrez vos adresses pour calculer)"; }
        return;
      }
      if(priceOut){ priceOut.textContent = "≈ " + p.toFixed(2) + " €"; }
    }

    if(estBtn){
      estBtn.addEventListener('click', function(e){
        e.preventDefault();
        e.stopPropagation();
        showPrice();
      }, true);
    }
  });
})();
</script>

</body></html>